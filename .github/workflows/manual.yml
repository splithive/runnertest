name: macOS Test

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]
  workflow_dispatch:  # Allow manual triggering

jobs:
  test-mac:
    runs-on: splithive  # Our custom runner label
    name: macOS Tests

    steps:
    - uses: actions/checkout@v4

    - name: System Info
      run: |
        echo "ğŸ–¥ï¸ macOS Version:"
        sw_vers
        
        echo "\nğŸƒâ€â™‚ï¸ Runner Info:"
        uname -a
        
        echo "\nğŸ’» CPU Info:"
        sysctl -n machdep.cpu.brand_string
        
        echo "\nğŸ§® Memory Info:"
        top -l 1 | grep PhysMem
        
        echo "\nğŸ’½ Disk Space:"
        df -h /

    - name: Test Command Line Tools
      run: |
        echo "ğŸ“¦ Homebrew Version:"
        brew --version || echo "Homebrew not installed"
        
        echo "\nğŸ Python Version:"
        python3 --version
        
        echo "\nâš™ï¸ Git Version:"
        git --version
        
        echo "\nğŸ”¨ Xcode Tools:"
        xcode-select -p || echo "Xcode tools not installed"

    - name: Test Network
      run: |
        echo "ğŸŒ Network Test:"
        ping -c 4 github.com
        
        echo "\nğŸ” DNS Resolution:"
        dig github.com +short
        
        echo "\nğŸŒ Public IP:"
        curl -s https://api.ipify.org

    - name: Test File Operations
      run: |
        echo "ğŸ“ File Operations Test"
        echo "Hello from macOS!" > test.txt
        cat test.txt
        mkdir -p test/nested
        touch test/nested/file.txt
        find test -type f
        ls -la test/nested

    - name: Test Process Management
      run: |
        echo "âš¡ Process Test:"
        ps aux | head -5
        
        echo "\nğŸ” Top Processes:"
        top -l 1 -n 5 -stats pid,command,cpu,mem

    - name: Test Environment
      run: |
        echo "ğŸŒ³ Environment Variables:"
        env | sort
        
        echo "\nğŸ“ Working Directory:"
        pwd
        ls -la

    - name: Test Permissions
      run: |
        echo "ğŸ”’ Current User:"
        whoami
        
        echo "\nğŸ‘¥ Groups:"
        groups
        
        echo "\nğŸ“‚ Home Directory Permissions:"
        ls -la ~/ | head -5

    - name: Cleanup
      if: always()
      run: |
        echo "ğŸ§¹ Cleaning up..."
        rm -rf test test.txt
        echo "âœ¨ Cleanup complete"
